workflows:
  android-workflow:
    name: Android Workflow
    max_build_duration: 60
    instance_type: mac_mini
    environment:
      vars:
        FCI_KEYSTORE_PATH: /tmp/keystore.keystore
        FCI_KEYSTORE: Encrypted(Z0FBQUFBQmd3WnVfWjN5Z0JSa3gyYnB5c0ZpTjNlR0J0aDBDYzA1Z2RmMkFWY1Q1amdPWXY2S3R1STZmTmRoMVNsQTlFazU1NExrcVJMMW02TmZfYXN1Y3FpcDZRckFhMFROb09EODFiREdkUUN1NEgtYTFUM014Zy1mNHl1OVZZMDRFUjlFbXdmbGVwRjNIcEpCZ3FOZVotNmdiNmdBRmpjZEViOENXV0Y4ZHVPTXp0cGtWVGdfd1V2ZWdBR0FtSkhieV9HMnllQ2tRTU9hTENnZWxkb29DSXhtc0JTS0hnaXZpZVJZY0d4c1B4bDI4MDZpVkpsSGdTNUxoQXM3MmdGR3l1bjdwZGNYUGM3YjhITXFaY3VLWDdOLVozTFRHRGxlR01WT1VDX0Q1dXlOMjVleHFDTTU5T2dFQ3o5a2RSaXpmTlg1VTJuTy1GMV9UTWY2Umxyb3RXR0tUYXhvY29iSHJwTndzMGZFZDBnTG9TdUNSY2xkd2cxLWFXNGpkQS1BdVlFUFB0dFZITlZuelR0RkhBeldrYUMxQjJBdXhaZ2hUY3NVbXZXZXhpaERtTmJDVHRwSkhUVWp5a1hIRmlxdXY1eGNlY1BkcmZBTjAwZVJzRVVnSXdWNWp1OEw2MzZYRkV1MjhCMzZ0aXFRVGk5Mmt6am04ZV9jTHZtRGR1TGY2Y3dRRXFXWldLMnJtNWZfQzNGNl9NaGUxcWZ5c2ViM3hoOWFndDRqemt1dnMtSXFMYW1QVmtPSDBIWmFpcFpyeUpHN1FnR2ppX3cwVGJkVjRMZDNmbE92Y3ZzZXNUYmREXzVkekZXamxEVmpJMjhGNzF5c1ZrMUxxSkNBVHhpQUlmRmdmNDVHeVBLa1c5ZkhmTU5PMG5aZjY3WFBHTU9qSTE2bnJ3dWpGVUctWVNJVEZETGZtWHZfbnRKZXFZVm1Lb2lieGV6YzFEN08zc2dNNURNdy1zbG9LRE8yWDJ4eDhrbE9GX2JBMHBnUEthYmtUZU1HdlhIR2xpSWI1YUdiZkRwejhBSnFsS0phX0RMWWFOMFlsbXUzSTV1QmVEUkh3SjBjZkFodUFzWXJnVDlSdVdPWDR3LV9HNU9RaFFSR1hLSUlWT2lxSVhYYzY1Q1U4dGRqaWlKNTdsdWlLYVBpRzI2bkRlYldZa0RSc09kVC1qMzJ0cE5wZTVlWEF0Qk91VW5EbGFrYjA1d1hSSVlrVmswemZLcnFXQW1oSlpieXgtWmdWQ1RGVW40UTFMWTY3eGMxOGF6d3NzS0gxUFBmUUdrWktlbUIySVpreGFFX1g0VUY3TW4tSzVzaXJJcW1GY0Jzc25NNG5hUGxxaXh1WXRmYkhVcnkzc3UtWkZYSy1EYzJQelFKZklqWGh4VUpOaUsxazUtTWNPR1VUS3FCdFlOQ0JvNkdPNDdIYTVnRnJ2UzRob01uZ2FQa0VOZnBmMk1KSnRZbm5GMTFVdENabTZJQlB1a3NxR01DQ3J2SjZhT0pTOTZVTkFYZlZUT0lUMGFwTHliMDEwb0lwdUVXazFXUHhuaUJMQ2dPWFNybzVBaHBITWZKWGFBRzZHejRrMG1HdFNicGdBTmhpczFkSFFRRlNKNGtWR1hGeGZjY3owcGM1Q2lmM0ducmFWVlg1WGVDZDhYSFFEb0tidXVZenZpNGJrZWVhT1VieG5SSGVkZ0h6eGFrNnBFR1l2eDlYYmY0emN4bFhqYVlpSTdYLTIzUEJaUHFvNWVFTXBLV1J6bXBVTEZfWWdZNmE0dENMbUNWb3d2NFhqY0tqQkVxd1BJXzYwT1FCdDhvdUtDS2JiOUc3N0x2bjNieEdfQ1dzRW1pbXU2aWtXWHdGOUQtNkJtU3Q5QXgzX1hTcFloZ3FmNVoxWGV2WmtpaTQ1STMweDJRV1A1bGNWVERsMGRfSXROM0lyeV9fcFRCV3B0UUxMdzYxS3M0Q2dEMjZzWkFWYUY5TGF2RkRUU0NPTHRhTEI2QWhVbFhVREx0VWV4Y1NTQ2Rnc0FtazVTV1M3N0pYQ0pFd1lET0xldm53S2dWVEdKVGllbi00Q3lka1l3ekwxUHh2aTRLQmZnaktSd1dGa0ZTVjBFRFpHYVVucDdNc0ZmeENqZjk3WEpjcC1Od1Q5WEhNMzBycS1UdmhNQXRZdXVfdnpOajRzQmR4SzhXd2VoeUVVT2hxSVEtNUJJdFRoYnUxSVBxUDdmTFU0dEFDSVd2RkJ4TGZsYUp4Q0JwRU9EblljbGtmZC1QUlRWN2c3aVFUUVpHVW5KYVI5Nm02Z2RCTVQ4c1RkbEJFZGczVnJkQ2huVjRIeXl2MDY3NzVWelhPZ2phRkwwbEF1empWVzlLaHBCeWZNVnA1VW53OVNpZ3pzbXRINEQtMXpZRlBUeUoxUWxMQXN2Tl9vMVQzOVVkdXBGd0ZYd2RiRTJTMEVfN3U0cl9PRmlwUXlYOUdpMnM5aFlhZEtGWmFrSkM3X25YVU8ydG5pdWFJWjlFcUJITDhFYl9ZUjljQW5uUkJxaFNFbFpoWHRkWUFWZzlLdWpqOUNoOHhWc1liTUo3c0lzOEZBNmRJM2NDak92emg0RkJNM3o2ZmZSOUJCUktWME50ODI5Vkl6Z0ZaVElfejZjRjhFblU2NVZES0hEMUV6c2RNRVJFcjdTek9uRjRZSXlueV9PRTQ4QnQ5cm4tb0d0Rkl0V0k4azIzRGg0MWVvSmk3RmprQXBNWmhkM19oMndwS1lrTWJBNzJBdk5hNl9zMmlyelQwNVBQb3ZOUWJ6VzJJVTBFQVJmOE53MlA4ZW12UGxKSUhnYTItWXhDSEVwS2VpM2hGNXRZazkxQ0NORV9DZG1sSDBNZ0J3bk9jYV9La2NrYUpwTkpDVE91OUFuX0t6TFpYUy01YUpqaFRRVlM4SHJONUpWZmtXZ0ZtVDRXdk5Bem5ESUktekFlZzFDOXBzOXZvakY4QXN4cjk2c1UzU0dSWWI2VXlhR3VIN082WTFkcjI2TFNmWURBV0VQR1RMRDRMWnJ6S29HenA5bkpUNEN3dzJKYVdQeUVzMDdpVjRxTnA3Q3phdkYtNFdMV2NuR2I0bV85c3lra1ZQekxuZFYyRXhFT2VQVU5xU1JvOERoWDBtRFVWYm5nZGp2dXNNdVF1dkpHTDdySkp0MmdaTTJoN3RmalB5ZUljQnh5UzhObGNWY1BFcld1eTdRNGVTQlFrT1dobE9wOU9hb3RpVWJneWdBdDBPcFIwOUhyME51MkVHTnJsR0wyY1hYZ2FxeF95LW93dmltd3Y0Nzh3SjA5eDdJTnhiM0thbW90NlY0emg4NWZtSkxYWlVFRkJJRlZMQ19EWVJRcWNHZmtFZ01rc0FUdEJRYlQ0MmdUUnppLS1oTVRsaU5wdnNTX3pwbk1pdjNvSXZRYW9IaXdwaE1uNEJGSWxhci1EQmY2YzNhaHFqTExVZjU2ejV2TlhMS2N3a0IwWVhUYUdGNFlJTVFEX3ptRU9WdjFLazhNMzRqQUkxM0lKemJGZHJQVV9tR2doTEYxczczT09iU2tHY2d4aHYwRXJZWmJtNGs0N1plOUNkX0Nzbkd3NlJKcGVYS1luVEI2ZkVTWkY5VVVldlNtUTYxLWdNVmlUQVJ1d3NxRXJ4TFlKSjRRVFRYaHB0bVhUSXJmWEZfNVd6UWcyTHJIUDY2MlpfRlFWQTdYN2RnYzVmcm1RTUR2YXRQLW45UlVVWXUyOVVXZWVNajBjeHBldVllSmZxNHVWVU5Ic3oyTkFJRjhBZkVXUjVoYmZwREkyWGg0UFdkU0M2SmdkaHNkUE14Z0s0ZDBhOFBhMDhQb1BKTVU3akN0cWlhMUFyNWZlNnIyNUgtVi03Zkx2aFhGVkhaUWQyYUZ2cVE2NVdXdDRYNEZDNHRSNDVhOEVMS1BuUEVGeF83UkZTYnVWSW9mZDdnVnRabDRkWm1LeVlSUjhoMW9ucVpFRVp4bTU5TC1uSS1EaFpaWTJTU2p2QTZzWjRZaHNBM2dXaFFUd0NaZVpfVkNWNUJvbE1CS1lsaU5pSVBaRkFjWkVhV0FPTGpZXzJMSGlaNGJXLTM2VmR6QmpmVktsSWY4dXJMc0g3emVudkRNWVpaSERpaTNyNDlMeVQ3RE5ka0dqaUE3U0ZTS3dWNVgzaVIzVzgtMURJZ2JXZVRPUmlUX2FvTGI5a19iQ2xoTzUweGN0bXVyRWt0a0F3Q3pBMmdENkZTRk1tRzFYaWg5bGl6Zl8yb1FnTU5Xc3FIclREQVRYRmpfOGVUNmpacWY2WGVOSk91MHlQV0owV2NPQkZiaGlfZ1JEUV82YVNYeXhBZDZOdEhnanJ1X2lVVFFWakZQMGRrTEs5QVZiYTdFSFFpUGJJVXl0NXYyY1ZlLVpXR2lIMHNkeWJNSGtIclh4TmdRMThyYXZQX0l2akVjbU0wSFBWQ0czVTRyRlJFaHFzRXVGMm1aM09DekZRZkVBYWV3U2owVVlBbEtQZjRfR2lQdFJwNDZaa0RZSG9pVnZlelVjaFMwV1VTT2ZId0c1SnppRUt3NjJNNUdJVFRoMWVIYWYwQ2FnX0MtaFpoNVFpVmpuUmRLMTBPVjJJcy05YXp2alNCWk80NTZ4X2Q2cU9pLWgyVTh3Y1k2MU5KZ2dmd3AteFFKeXBQYVNGSVNiejNOUVRHQ1Z3d1hsQnJtaG1KZnJ2V1FDeXVwUkJ4ZU93ZUNxWnFVTkI0UWI0TEdJUnBGT0F2MWJubF9zbUNXbVd2QjBBb1V2QzZ1S3NCM3c5YnlKOEZGUFBFTkZYYm4yU0dpR2hMU3ZzdGc3amlkWnVfOXpLM2d4RE83bFNVRDB2T0stWU9oOGFQbWp3anY0Y21obFY5Ry03MWhXdThsS29MR3R5TjFoOHJTREd5Y0UyTHJqeHR3V0xvWUtVaXE0RzVhVUJtNW1lOTZmT0xSczRLMDRaQ0dkcWYyTEhLUlA1VHNTSXJzbEh3WU5zcG45eUpNbU9yTHJIR1ZYWmNYWnVMYU9kb3JWd1dmRlVncTdldmRnaVFVRklPcy1IZmdGV2hWYW5SbnhuMUpVMl8yV1d4bXJTbFBQY2pJanJDTVppRlFGZmxhYlpEMUhMVzlLeGdYYVhIY2JROHBJMktfdnBHSy1XS1BqeTFFMDhsYWF2VHJ6Sk1BMzBTOFdEbGs4RVpsQ1BPU0wyNTJKdi1uTDJHclZ0MEM0VzhfMjVsLUtlOXJqLTJIcGJBUlF6TjBGR0YwLVN5eFFXT2dSRjR3MzJ5NjdMQ0Nzbko0ZERJbExCeldTVHNPam9TNEEyUjV1Z0wxV2w3NW9JTl9KN25YT2dLdVY2N0Q1cDBJSi0xc2tKUzlVRzhLQXA3YmpyOTloeTViM19BOUlCVTF2QV9qakI1SGduUWhpZkV6Q3luZ19Fb2tISENYbm0zWXllWFJiUDluUHFGV3ZZbUZpZ2NCQ05FSmZUcmlhSFlTS2FvYUNGdnpPaXF2Q0RMRmE0MVVfUjladkxPNEZRQ0M0Rk9hR3NMamNOS08wODNzdDRNN1hOSXlLYmpaQmMzR1FyRTQ2dXJrV0pFSmlCVWd1UVFDTmdqN3RHMzdZaHBWcXBsQzFjS0tpcnBYYVRqNTdhTFkyTVNLQm5lSklVMzc2TFJpdzBmUUpHcFF4Nm9ZWDVrNU16REJuSGNGWTkyb0s2MFNOVnJEeGswQm9EalFBSS1vZTBEVjd2SUdES2tIUjZXU0VyZy1LNld2ZDh4U3dfcWN6ZnRFb3BRLWc1UW1NVy1uOGlWWXpUclh5MGdYOGl3OFJINU1XdnAwcWFJMFM3OTNPZ21oS18wTm9WRFlucGtJM25BPT0=)
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmd3WmtBLTVEM2twLUtaNjIxaE5kdVRqMEVHZjdMdWwxdE5HTzRla045d1ZOQkl5TXNxZlBKWklER1k4Zlk5UWZkWlhldzh5ZmpUQmZFeFFoMnF3bmUtd2RTY2c9PQ==)
        FCI_KEY_PASSWORD: Encrypted(Z0FBQUFBQmd3WmtBLTVEM2twLUtaNjIxaE5kdVRqMEVHZjdMdWwxdE5HTzRla045d1ZOQkl5TXNxZlBKWklER1k4Zlk5UWZkWlhldzh5ZmpUQmZFeFFoMnF3bmUtd2RTY2c9PQ==)
        FCI_KEY_ALIAS: Encrypted(Z0FBQUFBQmd3WnY2Ri16ZWJtaUd0TWtSOGwyQ2Q5Sk4yWGxtM1dlZHV2T2tLWVlmX0pvWWN2VlhtbmwwSGQ1ejd3QktZdlYyN081ZnMxdmRGdWx5Ylh3cGs2akFaTlNJclE9PQ==)
      node: latest
    triggering:
      events:
        - push
        - tag
        - pull_request
      branch_patterns:
        - pattern: dev
          include: true
          source: true
    scripts:
      - name: Set up local properties
        script: echo "sdk.dir=$ANDROID_SDK_ROOT" > "$FCI_BUILD_DIR/local.properties"
      - name: Set up key.properties file for code signing
        script: |
          echo $FCI_KEYSTORE | base64 --decode > $FCI_KEYSTORE_PATH
          cat >> "$FCI_BUILD_DIR/key.properties" <<EOF
          storePassword=$FCI_KEYSTORE_PASSWORD
          keyPassword=$FCI_KEY_PASSWORD
          keyAlias=$FCI_KEY_ALIAS
          storeFile=$FCI_KEYSTORE_PATH
          EOF          
      - name: Build Android app
        script: ./gradlew assembleRelease
    artifacts:
      - app/build/outputs/**/**/*.apk